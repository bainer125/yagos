<html lang="en">
<head>
	<link rel="stylesheet" type="text/css" href="/css/scoreboard.css">
</head>
	<body>
		<select id="mode_select" onchange="send_event('mode_switch',document.getElementById('mode_select').value)">
			<option>Ice Hockey</option>
			<option>Soccer</option>
			<option>Baseball</option>
			<option>Football</option>
		</select>

		<div>
			<select id="league_select">
			</select>

			<select id="home_select">
			</select>

			<select id="away_select">
			</select>

			<select id="game_select" onchange="send_event('game_switch',document.getElementById('game_select').value)">
			</select>
		</div>
		<button class="up" id="btn_Scoreboard" value="true">Scoreboard</button>
		<button class="up" id="btn_Intermission" value="false">Intermission</button>
		<button class="up" id="btn_Commercial" value="false">Commercial</button>
		<button class="up" id="btn_Full_Screen" value="false">Full Screen</button>
		<button class="up" id="btn_Player_Info" value="false">Player Info</button>

	</body>
	<script type="text/javascript">

		var games = [];

		var leagues = [];

		var teams = {
			Teams: []
		};

		var home_info = {
			"Sport": "Ice Hockey",
			"League": "International",
			"City": "Ottawa",

			"Full Name": "Team Canada",
			"Location": "Canada",
			"Nickname": "Canadians",
			"Abbreviation": "OTT",

			"Color1": "#ff0000",
			"Color2": "#000000",
			"Color3": "#ffffff",
			"Color4": "#ffffff",

			"Logo1": "/Teams/International/Canada/logo1.png",
			"Logo2": "/Teams/International/Canada/logo2.png",
			"Logo3": "/Teams/International/Canada/logo3.png",
			"Logo4": "/Teams/International/Canada/logo4.png",
		}

		var away_info = {
			"Sport": "Ice Hockey",
			"League": "International",
			"City": "Ottawa",

			"Full Name": "Team Canada",
			"Location": "Canada",
			"Nickname": "Canadians",
			"Abbreviation": "OTT",

			"Color1": "#ff0000",
			"Color2": "#000000",
			"Color3": "#ffffff",
			"Color4": "#ffffff",

			"Logo1": "/Teams/International/Canada/logo1.png",
			"Logo2": "/Teams/International/Canada/logo2.png",
			"Logo3": "/Teams/International/Canada/logo3.png",
			"Logo4": "/Teams/International/Canada/logo4.png",
		}

		window.onload = function() {
			load_league_data(teams);
		    document.getElementById("league_select").addEventListener("change",load_team_data);
			document.getElementById("home_select").addEventListener("change",change_team);
			document.getElementById("away_select").addEventListener("change",change_team);
		}


		document.getElementById("btn_Scoreboard").addEventListener("click",function(){
			button_bool("btn_Scoreboard");
			send_event("btn_Scoreboard",document.getElementById("btn_Scoreboard").value);
		});

		document.getElementById("btn_Intermission").addEventListener("click",function(){
			button_bool("btn_Intermission");
			send_event("btn_Intermission",document.getElementById("btn_Intermission").value);
		});

		document.getElementById("btn_Commercial").addEventListener("click",function(){
			button_bool("btn_Commercial");
		});

		document.getElementById("btn_Full_Screen").addEventListener("click",function(){
			button_bool("btn_Full_Screen");
		});

		document.getElementById("btn_Player_Info").addEventListener("click",function(){
			button_bool("btn_Player_Info");
		});

		httpGetAsync("/current-scores/ice-hockey",function(res){

			g = Object.entries(JSON.parse(res));
			g.forEach(game => {
				var x = document.getElementById("game_select");
				var option = document.createElement("option");
				option.text = game[1].name;
				option.value = game[0];
				x.add(option);
				//console.log(game[1].clock.dur)
				games.push(game);
			})
		});

		function send_event(button,value){
			var xhr = new XMLHttpRequest();
			xhr.open("POST", "/control-panel", true);
			xhr.setRequestHeader('Content-Type', 'application/json');
			xhr.send(JSON.stringify({
			    "game": document.getElementById("game_select").value, "button": button, "value": value
			}));
		}

		function httpGetAsync(theUrl, callback){
		    var xmlHttp = new XMLHttpRequest();
		    xmlHttp.onreadystatechange = function() { 
		        if (xmlHttp.readyState == 4 && xmlHttp.status == 200)
		            callback(xmlHttp.responseText);
		    }
		    xmlHttp.open("GET", theUrl, true); // true for asynchronous 
		    xmlHttp.send(null);
		}

		function button_bool(btn){
			if(document.getElementById(btn).value=="true"){
				document.getElementById(btn).value="false";
				document.getElementById(btn).style.backgroundColor="red";
			}
			else{
				document.getElementById(btn).value="true";
				document.getElementById(btn).style.backgroundColor="green";
			}

			console.log(document.getElementById(btn).value);
		}

		function load_league_data(ti) {   

		    var xobj = new XMLHttpRequest();
		        xobj.overrideMimeType("application/json");
		    xobj.open('GET', '/team-data.json', true); // Replace 'my_data' with the path to your file
		    xobj.onreadystatechange = function () {
		        if (xobj.readyState == 4 && xobj.status == "200") {
		            // Required use of an anonymous callback as .open will NOT return a value but simply returns undefined in asynchronous mode
		            temp = JSON.parse(xobj.responseText);
		            Object.assign(ti,temp);

	            	ti.Teams.forEach(function(item,index){
						if(leagues.includes(ti.Teams[index].League)){
							//console.log("Do nothing");
						}
						else{
							leagues.push(ti.Teams[index].League);
						}
					});

					//console.log(leagues);

					leagues.forEach(function(item){
						var x = document.getElementById("league_select");
						var option = document.createElement("option");
						option.text = item;
						x.add(option);
					});
					//console.log(teams);
					load_team_data();
		        }
		    };
		    xobj.send(null);  
		}

		function load_team_data(){
			removeOptions(document.getElementById("home_select"));
			removeOptions(document.getElementById("away_select"));

			var filtered = teams.Teams.filter(function(a){
				var y=new RegExp(document.getElementById("league_select").value);
				//console.log(y);
				return y.test(a["League"]);
			});

			filtered.forEach(function(item){
				var x = document.getElementById("home_select");
				var option = document.createElement("option");
				option.text = item["Full Name"];
				x.add(option);
			});

			filtered.forEach(function(item){
				var x = document.getElementById("away_select");
				var option = document.createElement("option");
				option.text = item["Full Name"];
				x.add(option);
			});
		}

		function change_team(){
			var home = teams.Teams.filter(x => x["League"] == document.getElementById("league_select").value && x["Full Name"] == document.getElementById("home_select").value);
			var away = teams.Teams.filter(x => x["League"] == document.getElementById("league_select").value && x["Full Name"] == document.getElementById("away_select").value);
			//console.log(teams);
			//console.log(away[0]);


			Object.assign(home_info,home[0]);
			Object.assign(away_info,away[0]);

			home_info["Logo1"] = '/Teams/'.concat(home_info["League"],"/",home_info["Location"],"/logo1.png");
			away_info["Logo1"] = '/Teams/'.concat(away_info["League"],"/",away_info["Location"],"/logo1.png");
			//console.log(away_info);
/*
			filtered.forEach(function(item){
				var x = document.getElementById("home_select");
				var option = document.createElement("option");
				option.text = item["Full Name"];
				x.add(option);
			});
			*/
			send_event('home_change',home_info);
			send_event('away_change',away_info);
		}

		function removeOptions(selectbox)
		{
		    var i;
		    for(i = selectbox.options.length - 1 ; i >= 0 ; i--)
		    {
		        selectbox.remove(i);
		    }
		}

	</script>
</html>